# 常用函数

## 函数

> 函数在模板中的常用方式有两种
> 一种是`{:函数名('参数')}`
> 另一种`{变量|函数名=参数}`
> 函数在模板中的使用方式，具体请看tp5的使用说明
> [ThinkPHP5模板函数](https://www.kancloud.cn/manual/thinkphp5/125005)

## URL生成

`addon_url('ldcms/index/index')`

**参数解释：**
- `ldcms` 表示插件的名称
- `index` 表示控制器
- `index` 表示方法
- 该函数会自动适配伪静态

> 更多使用请看fastadmin的使用说明
> [FastAdmin URL生成](https://doc.fastadmin.net/developer/97.html)

## 字符串截取

> 建议使用函数时加上`ld_`前缀，后期版本会强制要求加上前缀 `v1.0.6及后期版本`

`ld_str_cut($str, $len, $charset = "utf-8")`

```html
//在标签中使用
{$item.title|ld_str_cut="10"}
```

## 格式化日期

> 建议使用函数时加上`ld_`前缀，后期版本会强制要求加上前缀 `v1.0.6及后期版本`

`ld_fdate($date, $format='Y-m-d H:i:s')`

```html
//在标签中使用
{$item.create_time|ld_fdate='Y-m-d'}
```

## 设置默认缩略图

在上传资料时候，如果没有上传对应的缩略图，可以设置一个统一的默认缩略图，方便展示！（图片路径可以自行设置）

```html
{$item.image|default='/assets/addons/ldcms/ksliansu/images/xwtp.jpg'}
```

## 实际应用示例

### 1. URL生成函数详细用法

```html
<!-- 基础用法 -->
<a href="{:addon_url('ldcms/index/index')}">首页</a>

<!-- 带参数的URL -->
<a href="{:addon_url('ldcms/detail/index', ['id'=>$item.id])}">详情页</a>

<!-- 栏目页URL -->
<a href="{:addon_url('ldcms/category/index', ['cid'=>$category.id])}">栏目页</a>

<!-- 搜索页URL -->
<form action="{:addon_url('ldcms/search/index')}" method="get">
    <input type="text" name="keyword" placeholder="请输入关键词">
    <button type="submit">搜索</button>
</form>

<!-- API接口URL -->
<script>
var apiUrl = "{:addon_url('ldcms/api/getData')}";
$.get(apiUrl, function(data) {
    console.log(data);
});
</script>
```

### 2. 字符串处理函数

```html
<!-- 标题截取 -->
<h3>{$item.title|ld_str_cut="20"}</h3>

<!-- 描述截取 -->
<p class="description">
    {$item.description|ld_str_cut="100"}
</p>

<!-- 内容摘要截取 -->
<div class="content-excerpt">
    {$item.content|strip_tags|ld_str_cut="150"}...
</div>

<!-- 多语言环境下的截取 -->
<div class="news-title">
    {if $lang == 'en'}
        {$item.title_en|ld_str_cut="30"}
    {else}
        {$item.title|ld_str_cut="20"}
    {/if}
</div>

<!-- 手机端标题截取 -->
<div class="mobile-title">
    {$item.title|ld_str_cut="15"}
</div>
```

### 3. 日期格式化函数

```html
<!-- 标准日期格式 -->
<span class="publish-date">{$item.create_time|ld_fdate='Y-m-d'}</span>

<!-- 完整时间格式 -->
<span class="full-datetime">{$item.create_time|ld_fdate='Y-m-d H:i:s'}</span>

<!-- 中文日期格式 -->
<span class="chinese-date">{$item.create_time|ld_fdate='Y年m月d日'}</span>

<!-- 相对时间显示 -->
<span class="relative-time">
    {if (time() - $item.create_time) < 86400}
        今天 {$item.create_time|ld_fdate='H:i'}
    {elseif (time() - $item.create_time) < 172800}
        昨天 {$item.create_time|ld_fdate='H:i'}
    {else}
        {$item.create_time|ld_fdate='m-d H:i'}
    {/if}
</span>

<!-- 更新时间显示 -->
<div class="update-info">
    发布时间：{$item.create_time|ld_fdate='Y-m-d'}
    {if $item.update_time && $item.update_time != $item.create_time}
    | 更新时间：{$item.update_time|ld_fdate='Y-m-d'}
    {/if}
</div>
```

### 4. 默认图片处理

```html
<!-- 基础默认图片 -->
<img src="{$item.image|default='/assets/addons/ldcms/images/default.jpg'}" 
     alt="{$item.title}">

<!-- 根据栏目设置不同默认图 -->
<img src="{$item.image|default='/assets/addons/ldcms/images/default_'~$category.id~'.jpg'}" 
     alt="{$item.title}">

<!-- 响应式默认图片 -->
<picture>
    <source media="(max-width: 768px)" 
            srcset="{$item.image_mobile|default='/assets/addons/ldcms/images/default_mobile.jpg'}">
    <img src="{$item.image|default='/assets/addons/ldcms/images/default.jpg'}" 
         alt="{$item.title}">
</picture>

<!-- 带占位符的图片 -->
<div class="image-container">
    {if $item.image}
        <img src="{$item.image}" alt="{$item.title}" class="content-image">
    {else}
        <div class="image-placeholder">
            <i class="fas fa-image"></i>
            <span>暂无图片</span>
        </div>
    {/if}
</div>

<!-- 缩略图和原图处理 -->
<div class="gallery-item">
    <a href="{$item.image|default='/assets/addons/ldcms/images/default_large.jpg'}" 
       data-lightbox="gallery">
        <img src="{$item.thumb|default='/assets/addons/ldcms/images/default_thumb.jpg'}" 
             alt="{$item.title}">
    </a>
</div>
```

### 5. 组合函数使用

```html
<!-- 标题处理：截取+默认值 -->
<h2 class="article-title">
    {$item.title|default='无标题'|ld_str_cut="25"}
</h2>

<!-- 内容摘要：去标签+截取+默认值 -->
<p class="article-summary">
    {$item.content|strip_tags|default='暂无内容'|ld_str_cut="120"}
</p>

<!-- 日期+作者信息 -->
<div class="article-meta">
    <span class="publish-info">
        {$item.create_time|ld_fdate='Y-m-d'} 
        by {$item.author|default='管理员'}
    </span>
    <span class="view-count">{$item.visits|default=0} 次阅读</span>
</div>

<!-- URL生成+参数组合 -->
<div class="share-buttons">
    <a href="{:addon_url('ldcms/share/weibo', ['url'=>urlencode(addon_url('ldcms/detail/index', ['id'=>$item.id]))])}" 
       target="_blank">分享到微博</a>
    <a href="{:addon_url('ldcms/share/qq', ['title'=>urlencode($item.title), 'url'=>urlencode(addon_url('ldcms/detail/index', ['id'=>$item.id]))])}" 
       target="_blank">分享到QQ</a>
</div>
```

### 6. 自定义函数扩展

```html
<!-- 价格格式化 -->
<span class="price">
    ¥{$item.price|number_format=2}
</span>

<!-- 文件大小格式化 -->
<span class="file-size">
    {$item.filesize|format_bytes}
</span>

<!-- 状态转换 -->
<span class="status status-{$item.status}">
    {$item.status|status_text}
</span>

<!-- 评分显示 -->
<div class="rating">
    {for start="1" end="5"}
        <i class="star {if $item.rating >= $i}active{/if}"></i>
    {/for}
    <span class="rating-text">({$item.rating|number_format=1}分)</span>
</div>

<!-- 距离计算 -->
<span class="distance">
    距离您 {$item.distance|format_distance}
</span>
```

### 7. 条件判断与函数结合

```html
<!-- 根据内容长度决定截取方式 -->
<div class="content-preview">
    {if strlen($item.content) > 200}
        {$item.content|strip_tags|ld_str_cut="150"}...
        <a href="{:addon_url('ldcms/detail/index', ['id'=>$item.id])}">阅读全文</a>
    {else}
        {$item.content|strip_tags}
    {/if}
</div>

<!-- 根据图片是否存在显示不同内容 -->
<div class="media-content">
    {if $item.image}
        <img src="{$item.image}" alt="{$item.title|ld_str_cut='30'}">
    {elseif $item.video}
        <video src="{$item.video}" poster="{$item.video_thumb|default='/assets/addons/ldcms/images/video_default.jpg'}"></video>
    {else}
        <div class="no-media">
            <i class="fas fa-file-text"></i>
            <span>纯文本内容</span>
        </div>
    {/if}
</div>

<!-- 根据时间显示不同样式 -->
<div class="time-info">
    {if (time() - $item.create_time) < 3600}
        <span class="time-new">刚刚发布</span>
    {elseif (time() - $item.create_time) < 86400}
        <span class="time-today">{$item.create_time|ld_fdate='H:i'}</span>
    {else}
        <span class="time-normal">{$item.create_time|ld_fdate='m-d'}</span>
    {/if}
</div>
```

### 8. Ajax和JavaScript中的函数使用

```html
<script>
// 动态获取URL
function loadMoreData(page) {
    var url = "{:addon_url('ldcms/api/getMore')}";
    $.post(url, {
        page: page,
        cid: {$category.id|default=0}
    }, function(response) {
        if (response.code === 1) {
            displayData(response.data);
        }
    });
}

// 动态生成详情页链接
function goToDetail(id) {
    var url = "{:addon_url('ldcms/detail/index')}";
    window.location.href = url + "?id=" + id;
}

// 搜索功能
function performSearch() {
    var keyword = $('#searchInput').val();
    var searchUrl = "{:addon_url('ldcms/search/index')}";
    window.location.href = searchUrl + "?keyword=" + encodeURIComponent(keyword);
}

// 收藏功能
function addToFavorite(id) {
    $.post("{:addon_url('ldcms/favorite/add')}", {
        id: id
    }, function(response) {
        if (response.code === 1) {
            alert('收藏成功');
        } else {
            alert(response.msg);
        }
    });
}
</script>
```

## ThinkPHP5 内置函数参考

### 字符串函数
```html
<!-- 大小写转换 -->
{$item.title|strtoupper}  <!-- 转大写 -->
{$item.title|strtolower}  <!-- 转小写 -->
{$item.title|ucfirst}     <!-- 首字母大写 -->

<!-- 字符串替换 -->
{$item.content|str_replace='老内容,新内容'}

<!-- 去除HTML标签 -->
{$item.content|strip_tags}

<!-- 去除空格 -->
{$item.title|trim}
```

### 时间函数
```html
<!-- 时间戳转日期 -->
{$item.create_time|date='Y-m-d H:i:s',###}

<!-- 相对时间 -->
{$item.create_time|time_ago}
```

### 数字函数
```html
<!-- 数字格式化 -->
{$item.price|number_format=2}

<!-- 数字转中文 -->
{$item.amount|number_to_chinese}
```

### 数组函数
```html
<!-- 数组计数 -->
{$item.tags|count}

<!-- 数组转字符串 -->
{$item.tags|implode=','}
```

---

*文档最后更新时间：2024-04-03 15:10:08*
*著作权归应用插件开发者所有，未经许可，禁止转载、复制此文档的任何内容。*