# 自定义表单

> 表单不会生成前台的表单HTML，需要手动制作form表单

## 自定义表单概述

### 表单的作用

自定义表单功能允许您创建各种类型的数据收集表单：
- **联系表单**：收集用户联系信息
- **报名表单**：活动或课程报名
- **调查表单**：问卷调查和反馈收集
- **预约表单**：服务预约和咨询
- **申请表单**：各种申请和登记

### 表单特点

- **灵活配置**：可自定义字段类型和验证规则
- **数据收集**：自动保存提交的表单数据
- **后台管理**：方便查看和管理提交的数据
- **权限控制**：可设置是否需要登录才能提交

## 添加表单

### 创建表单

#### 基本信息设置

| 字段名称 | 说明 | 要求 |
|----------|------|------|
| 表单名称 | 表单的显示名称 | 中文名称，用于后台显示 |
| 表名 | 数据库表名 | 只支持"字母、数字、下划线" |
| 表单描述 | 表单的用途说明 | 可选，便于管理 |
| 是否需要登录 | 是否需要用户登录 | 默认不开启 |

> **注意**：是否登录功能需要接入会员系统才能使用，系统默认没有接入会员功能。

#### 表单配置示例

```
表单名称：联系我们
表名：contact_form
表单描述：用户联系和咨询表单
是否需要登录：否
```

### 状态设置

| 状态 | 说明 | 用途 |
|------|------|------|
| 启用 | 表单正常接收数据 | 表单投入使用 |
| 禁用 | 暂停接收数据 | 临时关闭表单 |

## 表单字段管理

### 添加表单字段

#### 字段基本信息

| 配置项 | 说明 | 示例 |
|--------|------|------|
| 字段名称 | 显示给用户的标签 | "姓名"、"电话"、"邮箱" |
| 字段标识 | 数据库字段名 | name、phone、email |
| 字段类型 | 输入控件类型 | 文本框、下拉选择、文件上传 |
| 是否必填 | 验证规则 | 必填/可选 |
| 字段长度 | 数据库字段长度 | varchar(255) |
| 默认值 | 字段默认值 | 预设内容 |
| 字段说明 | 给用户的提示 | "请输入真实姓名" |

#### 常用字段类型

| 字段类型 | 适用场景 | HTML示例 |
|----------|----------|----------|
| 文本框 | 姓名、标题 | `<input type="text">` |
| 多行文本 | 留言内容 | `<textarea></textarea>` |
| 下拉选择 | 地区选择 | `<select><option></option></select>` |
| 单选框 | 性别选择 | `<input type="radio">` |
| 复选框 | 兴趣爱好 | `<input type="checkbox">` |
| 文件上传 | 简历上传 | `<input type="file">` |
| 日期选择 | 出生日期 | `<input type="date">` |
| 邮箱 | 邮箱地址 | `<input type="email">` |
| 电话 | 联系电话 | `<input type="tel">` |

### 字段验证规则

#### 基本验证

| 验证类型 | 说明 | 配置方式 |
|----------|------|----------|
| 必填验证 | 字段不能为空 | 设置"是否必填" |
| 长度验证 | 限制字符长度 | 设置"字段长度" |
| 格式验证 | 邮箱、电话格式 | 选择对应字段类型 |

#### 自定义验证

可以在字段配置中添加自定义验证规则：
- 正则表达式验证
- 数值范围验证
- 自定义错误提示

## 前台表单实现

### HTML表单结构

由于系统不自动生成前台HTML，需要手动创建表单：

```html
<form method="post" action="{:addon_url('ldcms/diyform/index')}">
    <!-- 表单类型（必需） -->
    <input type="hidden" name="type" value="联系我们">
    
    <!-- 防CSRF令牌（必需） -->
    <input type="hidden" name="__token__" value="{:token()}">
    
    <!-- 表单字段 -->
    <div class="form-group">
        <label for="name">姓名 <span class="required">*</span></label>
        <input type="text" id="name" name="name" required>
    </div>
    
    <div class="form-group">
        <label for="phone">联系电话 <span class="required">*</span></label>
        <input type="tel" id="phone" name="phone" required>
    </div>
    
    <div class="form-group">
        <label for="email">邮箱地址</label>
        <input type="email" id="email" name="email">
    </div>
    
    <div class="form-group">
        <label for="message">留言内容 <span class="required">*</span></label>
        <textarea id="message" name="message" rows="4" required></textarea>
    </div>
    
    <!-- 验证码（可选） -->
    <div class="form-group">
        <label for="captcha">验证码</label>
        <input type="text" id="captcha" name="captcha">
        <img src="{:captcha_src()}" onclick="this.src='{:captcha_src()}?'+Math.random()">
    </div>
    
    <div class="form-group">
        <button type="submit">提交</button>
    </div>
</form>
```

### 表单提交处理

#### AJAX提交示例

```javascript
$(document).ready(function() {
    $('#contact-form').on('submit', function(e) {
        e.preventDefault();
        
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            dataType: 'json',
            success: function(response) {
                if (response.code === 1) {
                    alert('提交成功！我们会尽快联系您。');
                    $('#contact-form')[0].reset();
                } else {
                    alert('提交失败：' + response.msg);
                }
            },
            error: function() {
                alert('网络错误，请稍后重试。');
            }
        });
    });
});
```

## 表单数据管理

### 查看表单数据

在后台可以查看所有提交的表单数据：

#### 数据列表显示

| 显示项 | 说明 |
|--------|------|
| 提交时间 | 用户提交的时间 |
| 提交IP | 用户的IP地址 |
| 表单字段 | 所有自定义字段的值 |
| 处理状态 | 已处理/未处理 |

#### 数据操作

- **查看详情**：查看单条数据的完整信息
- **批量导出**：导出为Excel文件
- **数据删除**：删除无用数据
- **状态标记**：标记处理状态

### 数据导出

支持将表单数据导出为Excel格式：
- 选择导出时间范围
- 选择导出字段
- 自定义文件名
- 一键下载

## 表单安全

### 安全措施

#### 基础安全

1. **CSRF防护**：使用`{:token()}`生成防CSRF令牌
2. **数据验证**：后端验证所有提交数据
3. **SQL注入防护**：使用参数化查询
4. **XSS防护**：过滤恶意脚本

#### 高级安全

```html
<!-- 验证码防护 -->
<input type="text" name="captcha" placeholder="请输入验证码">
<img src="{:captcha_src()}" onclick="this.src='{:captcha_src()}?'+Math.random()">

<!-- 蜜罐字段（防机器人） -->
<input type="text" name="website" style="display:none;">

<!-- 提交频率限制 -->
<script>
var submitBtn = document.getElementById('submit-btn');
var countdown = 60;

function startCountdown() {
    submitBtn.disabled = true;
    submitBtn.textContent = '请等待 ' + countdown + ' 秒';
    
    var timer = setInterval(function() {
        countdown--;
        if (countdown <= 0) {
            clearInterval(timer);
            submitBtn.disabled = false;
            submitBtn.textContent = '提交';
            countdown = 60;
        } else {
            submitBtn.textContent = '请等待 ' + countdown + ' 秒';
        }
    }, 1000);
}
</script>
```

## 表单样式

### CSS样式示例

```css
.form-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #333;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 5px rgba(0,123,255,0.3);
}

.required {
    color: #ff0000;
}

.submit-btn {
    background: #007bff;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
}

.submit-btn:hover {
    background: #0056b3;
}

.submit-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}
```

## 邮件通知

### 配置邮件通知

当用户提交表单时，可以自动发送邮件通知：

1. **配置SMTP**：在系统设置中配置邮件服务器
2. **设置接收邮箱**：指定接收通知的邮箱地址
3. **自定义邮件模板**：设置邮件标题和内容格式

### 邮件模板示例

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>新表单提交通知</title>
</head>
<body>
    <h2>您收到一条新的表单提交</h2>
    <p><strong>表单类型：</strong>联系我们</p>
    <p><strong>提交时间：</strong>{$create_time}</p>
    <p><strong>提交IP：</strong>{$ip}</p>
    
    <h3>表单内容：</h3>
    <table>
        <tr><td>姓名：</td><td>{$name}</td></tr>
        <tr><td>电话：</td><td>{$phone}</td></tr>
        <tr><td>邮箱：</td><td>{$email}</td></tr>
        <tr><td>留言：</td><td>{$message}</td></tr>
    </table>
    
    <p>请及时处理用户提交的信息。</p>
</body>
</html>
```

## 注意事项

### 开发注意事项

1. **字段添加后必须手动在前台模板中调用**
2. **表单提交地址必须正确**
3. **必需包含表单类型（type）参数**
4. **必需包含CSRF令牌**

### 数据安全

1. **定期备份表单数据**
2. **及时处理用户提交的信息**
3. **注意用户隐私保护**
4. **避免存储敏感信息**

### 用户体验

1. **提供清晰的字段说明**
2. **合理设置必填字段**
3. **及时反馈提交结果**
4. **优化表单加载速度**

---
*文档最后更新时间：2023-09-15*