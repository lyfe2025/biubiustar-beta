# 模板管理

> v1.2版本新上功能

## 模板管理概述

LDCMS的模板管理功能为网站提供了强大的多模板支持，让您可以轻松切换不同的网站外观和布局。

### 核心功能特点

- **多套模板**：网站默认自带2套模板，支持中英文模板
- **一键切换**：可以快速在不同模板间切换
- **模板上传**：支持上传开发好的模板压缩包
- **模板备份**：支持下载备份现有模板
- **数据携带**：模板支持携带演示数据
- **多语言支持**：每个语言对应一套独立模板

### 默认模板配置

系统默认提供以下模板：
- **中文模板**：适合中文网站的设计风格
- **英文模板**：适合英文网站的布局结构
- **响应式设计**：所有模板都支持PC和移动端自适应

## 切换模板

### 操作步骤

模板切换是一个三步流程，确保模板能够正确安装和配置。

#### 第一步：启用模板

1. 进入后台"模板管理"
2. 找到要启用的模板
3. 点击"启用"按钮
4. 系统会开始准备模板文件

![模板启用示例](image.png)

#### 第二步：选择语言

1. 在弹出的语言选择界面中
2. 选择要应用此模板的语言版本
3. 可以为不同语言选择不同的模板
4. 确认语言选择

![语言选择示例](image.png)

#### 第三步：导入数据

1. 选择是否导入模板携带的演示数据
2. **重要提示**：如果新模板与当前系统数据结构不一致，建议导入数据
3. 可以选择：
   - **导入数据**：使用模板自带的演示数据
   - **不导入**：保持现有网站数据
4. 确认完成切换

![数据导入选择](image.png)

> **注意**：自行选择导入或者不导入，如果新开发的模板与系统的数据不一致时，需要导入数据

## 模板开发规范

### 模板目录结构

```
template-name/
├── assets/                 # 静态资源
│   ├── css/               # 样式文件
│   ├── js/                # JavaScript文件
│   ├── images/            # 图片资源
│   └── fonts/             # 字体文件
├── view/                  # 模板文件
│   ├── index/             # 首页模板
│   ├── list/              # 列表页模板
│   ├── detail/            # 详情页模板
│   └── common/            # 公共模板
├── config.json            # 模板配置文件
└── data.sql              # 演示数据（可选）
```

### 模板配置文件

`config.json` 示例：
```json
{
    "name": "企业官网模板",
    "version": "1.0.0",
    "author": "开发者名称",
    "description": "适合企业官网的响应式模板",
    "screenshot": "screenshot.jpg",
    "languages": ["zh-cn", "en"],
    "dependencies": {
        "ldcms": ">=1.2.0"
    }
}
```

### 模板文件命名规范

| 文件类型 | 命名规范 | 示例 |
|----------|----------|------|
| 首页模板 | index.html | index.html |
| 列表页模板 | list.html | list.html |
| 详情页模板 | detail.html | detail.html |
| 搜索页模板 | search.html | search.html |
| 单页模板 | page.html | page.html |
| 标签页模板 | tag.html | tag.html |

## 模板上传与安装

### 上传模板包

#### 准备模板包
1. 将模板文件按照目录结构组织
2. 压缩为ZIP格式
3. 确保压缩包内直接包含模板文件，而不是多层目录

#### 上传步骤
1. 进入"模板管理"页面
2. 点击"上传模板"按钮
3. 选择准备好的ZIP文件
4. 等待上传完成
5. 系统自动解压并验证模板

#### 安装验证
上传完成后，系统会验证：
- 模板目录结构是否正确
- 必需文件是否存在
- 配置文件格式是否正确
- 版本兼容性检查

### 模板备份下载

#### 备份现有模板
1. 在模板列表中找到要备份的模板
2. 点击"下载"按钮
3. 系统会打包当前模板的所有文件
4. 自动下载ZIP格式的备份文件

#### 备份内容包含
- 所有模板文件
- 静态资源文件
- 配置文件
- 当前模板设置

## 多语言模板配置

### 语言模板映射

每个语言可以配置独立的模板：

| 语言 | 模板名称 | 说明 |
|------|----------|------|
| zh-cn | 中文企业模板 | 适合中文用户的设计风格 |
| en | English Business | 适合英文用户的布局 |
| ja | 日本語テンプレート | 适合日文网站 |

### 模板语言适配

#### CSS适配
```css
/* 中文字体 */
.zh-cn body {
    font-family: "Microsoft YaHei", "微软雅黑", sans-serif;
}

/* 英文字体 */
.en body {
    font-family: "Arial", "Helvetica", sans-serif;
}

/* 日文字体 */
.ja body {
    font-family: "Hiragino Sans", "ヒラギノ角ゴシック", sans-serif;
}
```

#### 布局适配
```html
<!-- 语言方向适配 -->
<html dir="{$lang_direction}" lang="{$current_lang}">

<!-- 语言特定样式 -->
<body class="lang-{$current_lang}">
```

## 模板优化

### 性能优化

#### 1. 静态资源优化
```html
<!-- CSS合并压缩 -->
<link rel="stylesheet" href="/assets/css/style.min.css">

<!-- JavaScript延迟加载 -->
<script defer src="/assets/js/app.min.js"></script>

<!-- 图片懒加载 -->
<img data-src="image.jpg" class="lazy-load" alt="描述">
```

#### 2. 缓存策略
```html
<!-- 设置缓存头 -->
<meta http-equiv="Cache-Control" content="max-age=3600">

<!-- 版本控制 -->
<link rel="stylesheet" href="/assets/css/style.css?v=1.0.0">
```

### SEO优化

#### 1. 元标签设置
```html
<title>{$seo_title|default=$category.name}</title>
<meta name="description" content="{$seo_description}">
<meta name="keywords" content="{$seo_keywords}">
```

#### 2. 结构化数据
```html
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "{$site.title}",
    "url": "{$site.domain}"
}
</script>
```

### 响应式设计

#### 1. 媒体查询
```css
/* 移动端适配 */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .nav-menu {
        display: none;
    }
}

/* 平板适配 */
@media (min-width: 769px) and (max-width: 1024px) {
    .sidebar {
        width: 25%;
    }
}
```

#### 2. 弹性布局
```css
.flex-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
}

.flex-item {
    flex: 1 1 300px;
    margin: 10px;
}
```

## 模板调试

### 开发模式

在开发过程中启用调试模式：
```php
// 在config.php中设置
'app_debug' => true,
'app_trace' => true,
```

### 模板变量调试

```html
<!-- 输出所有变量 -->
{$Think.dump}

<!-- 输出特定变量 -->
{$category|dump}

<!-- 条件输出 -->
{if $Think.const.APP_DEBUG}
    <pre>{$content|dump}</pre>
{/if}
```

### 错误处理

```html
<!-- 友好的错误提示 -->
{try}
    {$content.title}
{catch}
    <span class="error">内容加载失败</span>
{/try}

<!-- 默认值处理 -->
{$content.title|default="暂无标题"}
```

## 注意事项

### 开发注意事项

1. **兼容性**：确保模板与LDCMS版本兼容
2. **性能**：优化模板加载速度
3. **响应式**：支持多设备适配
4. **语言支持**：考虑多语言显示效果

### 安全注意事项

1. **数据过滤**：对用户输入进行适当过滤
2. **XSS防护**：使用safe过滤器处理HTML内容
3. **权限检查**：验证用户访问权限
4. **CSRF防护**：在表单中使用token验证

### 维护建议

1. **定期备份**：定期备份模板文件
2. **版本控制**：使用Git等工具管理模板版本
3. **文档记录**：记录模板的修改历史
4. **测试验证**：在多个环境中测试模板效果

---
*文档最后更新时间：2024-05-29*