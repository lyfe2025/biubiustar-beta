# 系统配置

LDCMS系统配置是管理整个网站运行的核心设置，包含网站开关、API配置、伪静态设置等重要功能。

## 配置项说明

| 名称 | 说明 |
|------|------|
| PC站点是否开启 | 网站是否开启 |
| 是否开启手机版 | 指独立的手机端网页，网站自带的模板是响应式的，所以没开启。如需开启，请在选中的模板下新建一个**wap**目录用于放置手机端模板 |
| API是否开启 | 网站默认是带api接口的，如果没有需求建议关闭 |
| API强制认证 | 建议开启并填写下方相关密钥 |
| API Appid | 建议填写6~32位的任意字符 |
| Api Secret | 建议填写6~32位的任意字符 |
| 相同的内链替换次数 | 用于控制文章中替换内链的次数 |
| 伪静态 | 网站前台伪静态 |
| 标志字典 | 为文章添加标识 |

## 伪静态说明

插件安装好之后我们访问插件首页是需要通过 [http://www.yoursite.com/ldcms/](http://www.yoursite.com/ldcms/) 来访问的，但这样对SEO不友好，所以我们需要去掉伪静态中的`/ldcms`。

例如：
- 原来首页的伪静态：`/ldcms/$`
- 修改后：`/$`

这时我们只需要 [http://www.yoursite.com](http://www.yoursite.com) 就可以访问到插件首页了。

## 提交表单发送到邮箱

### 第一步：先配置邮箱服务器

在系统配置中找到邮件设置，配置SMTP服务器信息：

- **SMTP服务器**：如 smtp.qq.com
- **SMTP端口**：如 465 或 587
- **邮箱账号**：发送邮件的邮箱地址
- **邮箱密码**：邮箱的授权码（不是登录密码）
- **加密方式**：SSL或TLS

### 第二步：配置邮件接收人

在站点配置中设置：
- **邮件接收人**：接收表单提交内容的邮箱地址
- **邮件模板**：可以自定义邮件发送的格式

## 标志字典说明

**标志字典**对应的是文章内容中**标识**字段。

通过标志字典可以为不同类型的文章添加特殊标识，如：
- 热门
- 推荐  
- 置顶
- 最新
- 精选

这些标识可以在前台模板中用于特殊显示效果。

## 实际应用示例

### 1. 完整的系统配置
```php
// 系统基础配置
'pc_status' => 1,           // PC站点开启
'mobile_status' => 0,       // 手机版关闭（使用响应式）
'api_status' => 1,          // API开启
'api_auth' => 1,            // API强制认证
'api_appid' => 'your_app_id_here',
'api_secret' => 'your_secret_key_here',
'link_replace_count' => 3,  // 内链替换3次
'rewrite' => 1,             // 开启伪静态
'flags' => '热门,推荐,置顶,最新'  // 标志字典
```

### 2. 伪静态规则配置
```apache
# Apache伪静态规则
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ index.php?s=/$1 [QSA,PT,L]

# 首页规则
RewriteRule ^$ /addons/ldcms/index/index [L]

# 栏目页规则  
RewriteRule ^category/([0-9]+)/?$ /addons/ldcms/category/index/cid/$1 [L]

# 详情页规则
RewriteRule ^detail/([0-9]+)/?$ /addons/ldcms/detail/index/id/$1 [L]

# 搜索页规则
RewriteRule ^search/?$ /addons/ldcms/search/index [L]

# 标签页规则
RewriteRule ^tag/(.+)/?$ /addons/ldcms/tag/index/tag/$1 [L]
```

### 3. Nginx伪静态规则
```nginx
# Nginx伪静态规则
location / {
    try_files $uri $uri/ /index.php?s=$uri&$args;
}

# 首页
location = / {
    rewrite ^(.*)$ /addons/ldcms/index/index last;
}

# 栏目页
location ~ ^/category/([0-9]+)/?$ {
    rewrite ^/category/([0-9]+)/?$ /addons/ldcms/category/index/cid/$1 last;
}

# 详情页  
location ~ ^/detail/([0-9]+)/?$ {
    rewrite ^/detail/([0-9]+)/?$ /addons/ldcms/detail/index/id/$1 last;
}

# 搜索页
location ~ ^/search/?$ {
    rewrite ^/search/?$ /addons/ldcms/search/index last;
}

# 标签页
location ~ ^/tag/(.+)/?$ {
    rewrite ^/tag/(.+)/?$ /addons/ldcms/tag/index/tag/$1 last;
}
```

### 4. API配置示例
```php
// API安全配置
$config = [
    'api_status' => true,                    // 开启API
    'api_auth' => true,                      // 强制认证
    'api_appid' => 'ldcms_app_2024',        // 应用ID
    'api_secret' => 'your_secret_key_32bit', // 密钥
    'api_expire' => 7200,                    // token过期时间
    'api_rate_limit' => 1000,                // 频率限制
];

// API调用示例
$headers = [
    'X-API-APPID: ldcms_app_2024',
    'X-API-TIMESTAMP: ' . time(),
    'X-API-SIGN: ' . md5($appid . $timestamp . $secret),
    'Content-Type: application/json'
];
```

### 5. 移动端配置
```php
// 移动端模板配置
if ($this->isMobile()) {
    // 检查是否有独立手机版模板
    $mobileTemplate = 'wap/' . $this->template;
    if (file_exists($mobileTemplate)) {
        $this->view->engine->config([
            'view_path' => ADDON_PATH . 'ldcms/view/wap/'
        ]);
    }
}
```

### 6. 标志字典应用
```html
<!-- 在模板中使用标志 -->
{ld:list limit="10"}
<article class="article-item">
    <h3>{$item.title}</h3>
    {if $item.flag}
    <div class="article-flags">
        {volist name="item.flag" id="flag"}
        <span class="flag flag-{$flag}">{$flag}</span>
        {/volist}
    </div>
    {/if}
    <p>{$item.description}</p>
</article>
{/ld:list}
```

### 7. 邮件模板配置
```html
<!-- 表单提交邮件模板 -->
<div style="padding: 20px; background: #f9f9f9;">
    <h2>新的表单提交</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 8px; border: 1px solid #ddd;"><strong>姓名</strong></td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$name}</td>
        </tr>
        <tr>
            <td style="padding: 8px; border: 1px solid #ddd;"><strong>邮箱</strong></td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$email}</td>
        </tr>
        <tr>
            <td style="padding: 8px; border: 1px solid #ddd;"><strong>手机</strong></td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$mobile}</td>
        </tr>
        <tr>
            <td style="padding: 8px; border: 1px solid #ddd;"><strong>内容</strong></td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$content}</td>
        </tr>
        <tr>
            <td style="padding: 8px; border: 1px solid #ddd;"><strong>提交时间</strong></td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$create_time}</td>
        </tr>
    </table>
</div>
```

### 8. 系统状态检测
```php
// 系统状态检测
class SystemStatus 
{
    public function checkStatus()
    {
        $status = [
            'pc_status' => $this->config['pc_status'],
            'api_status' => $this->config['api_status'],
            'rewrite_status' => $this->checkRewrite(),
            'email_status' => $this->checkEmail(),
            'cache_status' => $this->checkCache(),
            'storage_status' => $this->checkStorage(),
        ];
        
        return $status;
    }
    
    private function checkRewrite()
    {
        // 检测伪静态是否生效
        $testUrl = addon_url('ldcms/index/test');
        return $this->urlExists($testUrl);
    }
    
    private function checkEmail()
    {
        // 检测邮件配置
        return !empty($this->config['smtp_host']) && 
               !empty($this->config['smtp_user']);
    }
}
```

## 注意事项

1. **API安全**：开启API时务必配置强认证和复杂密钥
2. **伪静态**：修改伪静态规则后需重启Web服务器
3. **移动端**：独立手机版需要创建wap目录并复制模板文件
4. **邮件配置**：使用SMTP时注意端口和加密方式的匹配
5. **标志字典**：修改后需要重新编辑文章才能使用新标志

---

*文档最后更新时间：2023-09-15 14:02:19*
*著作权归应用插件开发者所有，未经许可，禁止转载、复制此文档的任何内容。*